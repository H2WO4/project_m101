{"apiVersion":1,"groups":[{"orgId":1,"name":"DB alerte","folder":"DB","interval":"10s","rules":[{"uid":"ffcxg7nsm4074e","title":"DB Connexions","condition":"C","data":[{"refId":"A","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"bfcpuipwgmww0f","model":{"editorMode":"code","expr":"pg_stat_database_numbackends{datname=\"cityflow\"}","instant":true,"intervalMs":1000,"legendFormat":"__auto","maxDataPoints":43200,"range":false,"refId":"A"}},{"refId":"C","relativeTimeRange":{"from":0,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[50],"type":"gt"},"operator":{"type":"and"},"query":{"params":["C"]},"reducer":{"params":[],"type":"last"},"type":"query"}],"datasource":{"type":"__expr__","uid":"__expr__"},"expression":"A","intervalMs":1000,"maxDataPoints":43200,"refId":"C","type":"threshold"}}],"noDataState":"NoData","execErrState":"Error","for":"1m","annotations":{"description":"Le nombre de connexions actives à PostgreSQL dépasse le seuil.\n\nActions :\n- Vérifier les connexions : SELECT * FROM pg_stat_activity;\n- Vérifier l’application (pooling, fuites de connexions)\n- Ajuster max_connections si nécessaire","runbook_url":"http://192.168.21.250:3000/d/000000039/postgresql-database?var-interval=$__auto\u0026orgId=1\u0026from=now-6h\u0026to=now\u0026timezone=browser\u0026var-DS_PROMETHEUS=bfcpuipwgmww0f\u0026var-namespace=\u0026var-release=\u0026var-instance=postgres-exporter:9187\u0026var-datname=$__all\u0026var-mode=$__all\u0026refresh=10s","summary":"Trop de connexions PostgreSQL actives"},"isPaused":false,"notification_settings":{"receiver":"Alerte Discord"}}]},{"orgId":1,"name":"vm-alerts","folder":"VM","interval":"10s","rules":[{"uid":"afcwng08cl9mof","title":"CPU VM \u003e 80%","condition":"C","data":[{"refId":"A","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"bfcpuipwgmww0f","model":{"editorMode":"code","expr":"100 * (1 - avg by (instance) (rate(node_cpu_seconds_total{mode=\"idle\"}[15s])))","instant":true,"intervalMs":1000,"legendFormat":"__auto","maxDataPoints":43200,"range":false,"refId":"A"}},{"refId":"C","relativeTimeRange":{"from":0,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[80],"type":"gte"},"operator":{"type":"and"},"query":{"params":["C"]},"reducer":{"params":[],"type":"last"},"type":"query"}],"datasource":{"type":"__expr__","uid":"__expr__"},"expression":"A","intervalMs":1000,"maxDataPoints":43200,"refId":"C","type":"threshold"}}],"noDataState":"NoData","execErrState":"Error","for":"1m","annotations":{"description":"L’utilisation du processeur de la machine virtuelle dépasse 80 % depuis plus de 30 secondes\nCela peut indiquer :\n- Une surcharge applicative\n- Un processus bloqué ou gourmand\n- Un problème de performance système\n\nVérifier les processus actifs avec htop ou top.","runbook_url":"http://192.168.21.250:3000/d/rYdddlPWk/vm-dashboard?orgId=1\u0026from=now-6h\u0026to=now\u0026timezone=browser\u0026var-ds_prometheus=bfcpuipwgmww0f\u0026var-job=node-exporter\u0026var-nodename=19873e603d8f\u0026var-node=node-exporter:9100\u0026refresh=5s","summary":"CPU élevé détecté sur la VM"},"isPaused":false,"notification_settings":{"receiver":"Alerte Discord"}},{"uid":"bfcwyt3q5ooowe","title":"RAM Utilisation \u003e 80%","condition":"C","data":[{"refId":"A","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"bfcpuipwgmww0f","model":{"editorMode":"code","expr":"100 * (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))","instant":true,"intervalMs":1000,"legendFormat":"__auto","maxDataPoints":43200,"range":false,"refId":"A"}},{"refId":"C","relativeTimeRange":{"from":0,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[80],"type":"gte"},"operator":{"type":"and"},"query":{"params":["C"]},"reducer":{"params":[],"type":"last"},"type":"query"}],"datasource":{"type":"__expr__","uid":"__expr__"},"expression":"A","intervalMs":1000,"maxDataPoints":43200,"refId":"C","type":"threshold"}}],"noDataState":"NoData","execErrState":"Error","for":"10s","annotations":{"description":"L'utilisation de la mémoire dépasse le seuil critique.\n\nCela peut indiquer :\n• Trop d’applications ouvertes\n• Une fuite mémoire\n• Un service gourmand\n\nVérifier la mémoire avec :\nfree -h\ntop / htop","runbook_url":"http://192.168.21.250:3000/d/rYdddlPWk/vm-dashboard?orgId=1\u0026from=now-6h\u0026to=now\u0026timezone=browser\u0026var-ds_prometheus=bfcpuipwgmww0f\u0026var-job=node-exporter\u0026var-nodename=19873e603d8f\u0026var-node=node-exporter:9100\u0026refresh=5s","summary":"RAM élevée détectée sur la VM"},"isPaused":false,"notification_settings":{"receiver":"Alerte Discord"}},{"uid":"afcxadwudihvke","title":"Disque Utilisation \u003e 80%","condition":"C","data":[{"refId":"A","relativeTimeRange":{"from":600,"to":0},"datasourceUid":"bfcpuipwgmww0f","model":{"editorMode":"code","expr":"100 * (\r\n  (node_filesystem_size_bytes{instance=\"node-exporter:9100\", device!~\"rootfs\", fstype!~\"tmpfs|overlay|squashfs\"}\r\n - node_filesystem_avail_bytes{instance=\"node-exporter:9100\", device!~\"rootfs\", fstype!~\"tmpfs|overlay|squashfs\"})\r\n / node_filesystem_size_bytes{instance=\"node-exporter:9100\", device!~\"rootfs\", fstype!~\"tmpfs|overlay|squashfs\"}\r\n)\r\n","instant":true,"intervalMs":1000,"legendFormat":"__auto","maxDataPoints":43200,"range":false,"refId":"A"}},{"refId":"C","relativeTimeRange":{"from":0,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[80],"type":"gte"},"operator":{"type":"and"},"query":{"params":["C"]},"reducer":{"params":[],"type":"last"},"type":"query"}],"datasource":{"type":"__expr__","uid":"__expr__"},"expression":"A","intervalMs":1000,"maxDataPoints":43200,"refId":"C","type":"threshold"}}],"noDataState":"NoData","execErrState":"Error","for":"10s","annotations":{"description":"L’utilisation du disque dépasse 80%.\n\nActions :\n- Vérifier l’espace : df -h\n- Chercher les gros dossiers : du -sh /* | sort -h\n- Nettoyer logs / cache si nécessaire","runbook_url":"http://192.168.21.250:3000/d/rYdddlPWk/vm-dashboard?orgId=1\u0026from=now-6h\u0026to=now\u0026timezone=browser\u0026var-ds_prometheus=bfcpuipwgmww0f\u0026var-job=node-exporter\u0026var-nodename=19873e603d8f\u0026var-node=node-exporter:9100\u0026refresh=5s","summary":"Disque presque plein sur la VM"},"isPaused":false,"notification_settings":{"receiver":"Alerte Discord"}}]}]}